<div class="container">
  <h2>Your Profile</h2>

  <%= form_with(model: @user, url: profile_path, method: :patch, class: "activity-form") do |f| %>
    <% if @user.errors.any? %>
      <div class="form-errors">
        <h4><%= pluralize(@user.errors.count, "error") %> prevented saving:</h4>
        <ul>
          <% @user.errors.full_messages.each do |msg| %>
            <li><%= msg %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <fieldset class="profile-section">
      <legend class="section-title">Basic Info</legend>

      <div class="form-group">
        <%= f.label :display_name, "Display Name" %>
        <%= f.text_field :display_name, placeholder: "Optional nickname", class: "form-input" %>
      </div>

      <div class="form-group">
        <%= f.label :date_of_birth, "Date of Birth" %>
        <%= f.date_field :date_of_birth, class: "form-input", max: Time.zone.today.iso8601 %>
      </div>

      <div class="form-group">
        <%= f.label :sex %>
        <%= f.select :sex, User::SEXES.map { |s| [s.capitalize, s] },
            { include_blank: "Select..." }, class: "form-input" %>
      </div>

      <div class="form-group">
        <%= f.label :race_ethnicity, "Race / Ethnicity (optional)" %>
        <%= f.text_field :race_ethnicity, placeholder: "Optional", class: "form-input" %>
      </div>

      <div class="form-group">
        <%= f.label :timezone, "Timezone" %>
        <%= f.time_zone_select :timezone, ActiveSupport::TimeZone.us_zones, { default: "Eastern Time (US & Canada)" }, class: "form-input" %>
      </div>
    </fieldset>

    <fieldset class="profile-section">
      <legend class="section-title">Body Measurements</legend>

      <div class="form-row">
        <div class="form-group form-group-half">
          <%= f.label :weight, "Weight (lbs)" %>
          <%= f.number_field :weight, step: 0.1, min: 0, placeholder: "e.g. 165", class: "form-input" %>
        </div>
        <div class="form-group form-group-half">
          <%= f.label :height, "Height (inches)" %>
          <%= f.number_field :height, step: 0.1, min: 0, placeholder: "e.g. 70", class: "form-input" %>
          <span class="form-hint">e.g. 70 = 5'10"</span>
        </div>
      </div>
    </fieldset>

    <fieldset class="profile-section">
      <legend class="section-title">Health Data</legend>

      <div class="form-row">
        <div class="form-group form-group-half">
          <%= f.label :blood_pressure_systolic, "BP Systolic" %>
          <%= f.number_field :blood_pressure_systolic, min: 60, max: 250, placeholder: "120", class: "form-input" %>
        </div>
        <div class="form-group form-group-half">
          <%= f.label :blood_pressure_diastolic, "BP Diastolic" %>
          <%= f.number_field :blood_pressure_diastolic, min: 30, max: 150, placeholder: "80", class: "form-input" %>
        </div>
      </div>
      <span class="form-hint">Blood pressure in mmHg</span>

      <div class="form-group" style="margin-top: 16px;">
        <%= f.label :health_concerns, "Health Concerns" %>
        <%= f.text_area :health_concerns, rows: 3,
            placeholder: "e.g. diabetes, high blood pressure, allergies...",
            class: "form-input" %>
      </div>
    </fieldset>

    <fieldset class="profile-section">
      <legend class="section-title">Activity & Goals</legend>

      <div class="form-group">
        <%= f.label :activity_level, "Activity Level" %>
        <%= f.select :activity_level,
            User::ACTIVITY_LEVELS.map { |l| [l.humanize, l] },
            { include_blank: "Select..." }, class: "form-input" %>
      </div>

      <div class="form-group">
        <%= f.label :goal, "Goal" %>
        <%= f.select :goal,
            User::GOALS.map { |g| [g.humanize, g] },
            { include_blank: "Select..." }, class: "form-input" %>
      </div>

      <div class="form-group">
        <%= f.label :water_goal_cups, "Daily Water Goal (cups)" %>
        <%= f.number_field :water_goal_cups, min: 1, max: 50, step: 0.1,
            placeholder: @user.recommended_water_cups || 8,
            class: "form-input" %>
        <% if @user.recommended_water_cups %>
          <span class="form-hint">
            Suggested: <%= @user.recommended_water_cups %> cups â€” based on half your body weight (<%= @user.weight.to_i %> lbs) in ounces (<%= (@user.weight * 0.5).round(0) %> oz), converted to cups.
            Leave blank to use this calculated value.
          </span>
        <% end %>
      </div>

      <div class="form-group">
        <%= f.label :prayer_goal_minutes, "Prayer / Meditation Goal (minutes per day)" %>
        <%= f.number_field :prayer_goal_minutes, min: 1, max: 480, step: 1, placeholder: "15", class: "form-input" %>
      </div>

      <div class="form-group">
        <%= f.label :fasting_start_hour, "Fasting Reminder Time" %>
        <%= f.select :fasting_start_hour,
            (16..23).map { |h| ["#{h > 12 ? h - 12 : h} #{h >= 12 ? 'PM' : 'AM'}", h] },
            { include_blank: "Default (8 PM)" }, class: "form-input" %>
        <span class="form-hint">
          After this time, you'll see a fasting reminder and get a browser notification to stop eating. Only water and fluids allowed.
        </span>
      </div>
    </fieldset>

    <div class="form-actions">
      <%= f.submit "Save Profile", class: "btn btn-primary" %>
      <%= link_to "Cancel", profile_path, class: "btn btn-outline" %>
    </div>
  <% end %>
</div>
